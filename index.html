<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Company Ads</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000000;
      overflow: hidden;
    }
    #slideshow {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000000;
    }
    #slideshow img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      transition: opacity 0.5s ease-in-out;
    }
    #slideshow.paused {
      border: 5px solid #ff0000;
    }
    #slideshow.fade img {
      transition: opacity 1s ease-in-out;
    }
    #syncIndicator {
      position: fixed;
      top: 10px;
      left: 10px;
      padding: 10px 15px;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 5px;
      font-family: Arial, sans-serif;
      font-size: 12px;
      color: white;
      z-index: 100;
      border-left: 4px solid #666;
    }
    #syncIndicator.synced {
      border-left-color: #00ff00;
      color: #00ff00;
    }
    #syncIndicator.local {
      border-left-color: #ffaa00;
      color: #ffaa00;
    }
    #syncIndicator.error {
      border-left-color: #ff0000;
      color: #ff0000;
    }
    #adminPanel {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      z-index: 1000;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      font-family: Arial, sans-serif;
      color: #00ff99;
      padding: 20px;
      overflow-y: auto;
      overflow-x: hidden;
    }
    #adminPanel.open {
      display: flex;
    }
    #adminPanel h1 {
      font-size: 32px;
      margin: 0 0 20px 0;
      color: #ff0000;
      text-shadow: 0 0 10px #ff0000;
    }
    .admin-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      max-width: 1000px;
      width: 100%;
    }
    .admin-section {
      background: rgba(0, 255, 153, 0.1);
      border: 2px solid #00ff99;
      border-radius: 8px;
      padding: 15px;
      color: #00ff99;
    }
    .admin-section h2 {
      margin: 0 0 10px 0;
      font-size: 16px;
      border-bottom: 1px solid #00ff99;
      padding-bottom: 8px;
    }
    .admin-row {
      margin: 8px 0;
      display: flex;
      gap: 10px;
      align-items: center;
      font-size: 12px;
    }
    .admin-row label {
      min-width: 100px;
      color: #aaa;
    }
    .admin-row span {
      color: #00ff99;
      font-weight: bold;
    }
    .admin-row input {
      width: 60px;
      padding: 5px;
      background: rgba(0, 255, 153, 0.1);
      border: 1px solid #00ff99;
      color: #00ff99;
      border-radius: 4px;
    }
    .admin-btn {
      background: #00ff99;
      color: #000;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 12px;
      margin: 5px;
    }
    .admin-btn:hover {
      background: #00dd77;
    }
    #logViewer {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid #00ff99;
      border-radius: 4px;
      padding: 10px;
      max-height: 150px;
      overflow-y: auto;
      font-size: 11px;
      font-family: monospace;
      color: #0f0;
    }
    .log-entry {
      margin: 2px 0;
    }
    #adminClose {
      font-size: 12px;
      color: #666;
      margin-top: 20px;
    }
    .slider-container {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
    }
    .slider-container input[type="range"] {
      flex: 1;
      height: 4px;
      background: rgba(0, 255, 153, 0.3);
      border-radius: 2px;
      outline: none;
    }
    .slider-container input[type="range"]::-webkit-slider-thumb {
      width: 15px;
      height: 15px;
      background: #00ff99;
      cursor: pointer;
      border-radius: 50%;
    }
    .slider-container span {
      min-width: 40px;
      text-align: right;
    }
    #emergencyOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #ff0000;
      z-index: 500;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: white;
      font-weight: bold;
      text-align: center;
      padding: 20px;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
</head>
<body>
  <div id="syncIndicator" class="local">‚ö™ SYNCING...</div>
  
  <div id="emergencyOverlay"></div>
  
  <div id="slideshow">
    <img id="slide" src="ads/ad1.png" alt="Ad" />
  </div>

  <div id="adminPanel">
    <h1>üöÄ SUPREME COMMANDER KIM JONG UN ADMIN PANEL üöÄ</h1>
    
    <div class="admin-grid">
      <div class="admin-section">
        <h2>üìä System Status</h2>
        <div class="admin-row">
          <label>Sync Status:</label>
          <span id="statusSync">üü° Checking...</span>
        </div>
        <div class="admin-row">
          <label>Latency:</label>
          <span id="statusLatency">-ms</span>
        </div>
        <div class="admin-row">
          <label>Current Slide:</label>
          <span id="statusSlide">1/3</span>
        </div>
        <div class="admin-row">
          <label>Server Time:</label>
          <span id="statusTime">--:--:--</span>
        </div>
      </div>

      <div class="admin-section">
        <h2>‚öôÔ∏è Slideshow Control</h2>
        <div class="admin-row">
          <label>Duration (s):</label>
          <input type="number" id="durationInput" min="1" max="60" value="10">
          <button class="admin-btn" onclick="updateDuration()">Apply</button>
        </div>
        <div class="admin-row">
          <button class="admin-btn" onclick="prevSlide()">‚Üê Prev</button>
          <button class="admin-btn" onclick="nextSlide()">Next ‚Üí</button>
        </div>
        <div class="admin-row">
          <button class="admin-btn" id="pauseBtn" onclick="togglePause()">‚è∏Ô∏è Pause</button>
          <button class="admin-btn" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>
        </div>
      </div>

      <div class="admin-section">
        <h2>üé® Display Settings</h2>
        <div class="admin-row">
          <label>Brightness:</label>
          <div class="slider-container">
            <input type="range" id="brightnessSlider" min="50" max="150" value="100" oninput="updateBrightness()">
            <span id="brightnessValue">100%</span>
          </div>
        </div>
        <div class="admin-row">
          <label>Contrast:</label>
          <div class="slider-container">
            <input type="range" id="contrastSlider" min="50" max="150" value="100" oninput="updateContrast()">
            <span id="contrastValue">100%</span>
          </div>
        </div>
        <div class="admin-row">
          <button class="admin-btn" onclick="toggleTransitions()">‚ú® Toggle Fade</button>
          <button class="admin-btn" onclick="toggleAutoDim()">üåô Auto-Dim</button>
        </div>
      </div>

      <div class="admin-section">
        <h2>üîÑ Sync & Network</h2>
        <button class="admin-btn" onclick="manualSync()">Force Sync Now</button>
        <button class="admin-btn" onclick="checkLatency()">Check Latency</button>
      </div>

      <div class="admin-section">
        <h2>ÔøΩ Statistics</h2>
        <div class="admin-row">
          <label>Uptime:</label>
          <span id="statusUptime">0s</span>
        </div>
        <div class="admin-row">
          <label>Total Errors:</label>
          <span id="statusErrors">0</span>
        </div>
        <div class="admin-row">
          <label>Impressions:</label>
          <span id="statusImpressions">0</span>
        </div>
        <div class="admin-row">
          <label>Cycles:</label>
          <span id="statusCycles">0</span>
        </div>
      </div>

      <div class="admin-section">
        <h2>üîß Utilities</h2>
        <button class="admin-btn" onclick="reloadPage()">üîÑ Reload Page</button>
        <button class="admin-btn" onclick="clearLogs()">Clear Logs</button>
        <button class="admin-btn" onclick="exportLogs()">üíæ Export Logs</button>
        <button class="admin-btn" onclick="resetStats()">üìä Reset Stats</button>
      </div>

      <div class="admin-section" style="grid-column: 1/-1;">
        <h2>üö® Emergency Broadcast</h2>
        <div class="admin-row">
          <input type="text" id="emergencyText" placeholder="Enter emergency message..." style="flex: 1; width: auto; min-width: 300px;">
          <button class="admin-btn" onclick="toggleEmergency()">üî¥ BROADCAST</button>
        </div>
      </div>

      <div class="admin-section" style="grid-column: 1/-1;">
        <h2>üìù System Log</h2>
        <div id="logViewer"></div>
      </div>
    </div>

    <div id="adminClose">Press ESC to close | Type 123 to reopen</div>
  </div>

  <script>
    const images = [
      "ads/ad1.png",
      "ads/ad2.png",
      "ads/ad3.png"
    ];
    
    let currentIndex = 0;
    let previousIndex = -1;
    const slideElement = document.getElementById("slide");
    const syncIndicator = document.getElementById("syncIndicator");
    const adminPanel = document.getElementById("adminPanel");
    const logViewer = document.getElementById("logViewer");
    let slideDuration = 30000; // 30 seconds per slide
    
    // Server configuration for emergency broadcast
    const serverURL = "http://localhost:3000";
    let isCheckingEmergency = false;
    
    // Time sync variables
    let serverTimeOffset = 0;
    let syncedTime = false;
    let lastSyncLatency = 0;
    let systemLog = [];
    let keySequence = "";
    
    // Feature toggles and stats
    let isPaused = false;
    let fadeEnabled = false;
    let autoDimEnabled = false;
    let emergencyMode = false;
    let brightness = 100;
    let contrast = 100;
    let startTime = Date.now();
    let totalErrors = 0;
    let totalImpressions = 0;
    let totalCycles = 0;

    function addLog(msg) {
      const time = new Date().toLocaleTimeString();
      systemLog.push("[" + time + "] " + msg);
      if (systemLog.length > 50) systemLog.shift();
      updateLogView();
      console.log(msg);
    }

    function updateLogView() {
      if (logViewer) {
        logViewer.innerHTML = systemLog.map(l => '<div class="log-entry">' + l + '</div>').join('');
        logViewer.scrollTop = logViewer.scrollHeight;
      }
    }

    function updateStatusDisplay() {
      const serverTime = getServerTime();
      if (document.getElementById("statusTime")) {
        document.getElementById("statusTime").textContent = new Date(serverTime).toLocaleTimeString();
      }
      if (document.getElementById("statusSlide")) {
        document.getElementById("statusSlide").textContent = (currentIndex + 1) + "/3";
      }
      if (document.getElementById("statusSync")) {
        document.getElementById("statusSync").textContent = syncedTime ? "üü¢ SYNCED" : "üü° LOCAL TIME";
      }
      if (document.getElementById("statusLatency")) {
        document.getElementById("statusLatency").textContent = lastSyncLatency + "ms";
      }
      
      // Update stats
      const uptime = Math.floor((Date.now() - startTime) / 1000);
      const hours = Math.floor(uptime / 3600);
      const mins = Math.floor((uptime % 3600) / 60);
      const secs = uptime % 60;
      const uptimeStr = hours > 0 ? hours + "h " + mins + "m" : mins > 0 ? mins + "m " + secs + "s" : secs + "s";
      
      if (document.getElementById("statusUptime")) {
        document.getElementById("statusUptime").textContent = uptimeStr;
      }
      if (document.getElementById("statusErrors")) {
        document.getElementById("statusErrors").textContent = totalErrors;
      }
      if (document.getElementById("statusImpressions")) {
        document.getElementById("statusImpressions").textContent = totalImpressions;
      }
      if (document.getElementById("statusCycles")) {
        document.getElementById("statusCycles").textContent = totalCycles;
      }
    }

    // Get accurate server time - AGGRESSIVE API SYNCING, NO FALLBACK
    async function syncServerTime() {
      const t0 = performance.now();
      
      // Array of time API sources to try in order - with longer timeouts
      const timeSources = [
        {
          name: "worldtimeapi.org/ip",
          fetch: async () => {
            const res = await fetch("https://worldtimeapi.org/api/ip", { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            return new Date(data.datetime).getTime();
          }
        },
        {
          name: "timeapi.io/UTC",
          fetch: async () => {
            const res = await fetch("https://timeapi.io/api/Time/current/zone?timeZone=UTC", { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            return new Date(data.dateTime).getTime();
          }
        },
        {
          name: "worldtimeapi.org/UTC",
          fetch: async () => {
            const res = await fetch("https://worldtimeapi.org/api/timezone/UTC", { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            return new Date(data.datetime).getTime();
          }
        },
        {
          name: "timeapi.io/London",
          fetch: async () => {
            const res = await fetch("https://timeapi.io/api/Time/current/timeZone?timeZone=Europe/London", { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            return new Date(data.dateTime).getTime();
          }
        },
        {
          name: "worldtimeapi.org/London",
          fetch: async () => {
            const res = await fetch("https://worldtimeapi.org/api/timezone/Europe/London", { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            return new Date(data.datetime).getTime();
          }
        },
        {
          name: "worldtimeapi.org/Paris",
          fetch: async () => {
            const res = await fetch("https://worldtimeapi.org/api/timezone/Europe/Paris", { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            return new Date(data.datetime).getTime();
          }
        },
        {
          name: "timeapi.io/Amsterdam",
          fetch: async () => {
            const res = await fetch("https://timeapi.io/api/Time/current/timeZone?timeZone=Europe/Amsterdam", { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            return new Date(data.dateTime).getTime();
          }
        }
      ];
      
      // Try each source in order with 8 second timeout each
      for (const source of timeSources) {
        try {
          const serverMs = await Promise.race([
            source.fetch(),
            new Promise((_, reject) => setTimeout(() => reject(new Error("Timeout")), 8000))
          ]);
          
          const localMs = Date.now();
          const t1 = performance.now();
          lastSyncLatency = Math.round(t1 - t0);
          serverTimeOffset = serverMs - localMs;
          syncedTime = true;
          
          addLog("‚úì SYNCED (" + source.name + ") - latency: " + lastSyncLatency + "ms");
          syncIndicator.className = "synced";
          syncIndicator.textContent = "üü¢ SYNCED - " + lastSyncLatency + "ms";
          return true;
        } catch (err) {
          addLog("‚úó " + source.name + " failed: " + err.message);
          // Continue to next source
        }
      }
      
      // If we get here, keep retrying the first API every 2 seconds
      addLog("‚ö†Ô∏è All APIs failed, retrying first source in 2s...");
      syncIndicator.className = "error";
      syncIndicator.textContent = "üî¥ RETRYING...";
      
      // Retry the first API after 2 seconds
      setTimeout(syncServerTime, 2000);
      return false;
    }

    function getServerTime() {
      return Date.now() + serverTimeOffset;
    }

    function updateSlide() {
      if (isPaused || emergencyMode) return;
      
      const serverTime = getServerTime();
      const cycleTime = serverTime % (slideDuration * images.length);
      const newIndex = Math.floor(cycleTime / slideDuration);
      
      if (newIndex !== currentIndex) {
        // Fade effect
        if (fadeEnabled) {
          slideElement.style.opacity = "0";
          setTimeout(() => {
            currentIndex = newIndex;
            slideElement.src = images[currentIndex];
            slideElement.style.opacity = "1";
          }, 500);
        } else {
          currentIndex = newIndex;
          slideElement.src = images[currentIndex];
        }
        
        totalImpressions++;
        console.log("Slide", currentIndex + 1, "| Server time:", new Date(serverTime).toISOString());
        
        // Auto-dim at night (10pm - 6am)
        if (autoDimEnabled) {
          const hour = new Date(serverTime).getHours();
          if (hour >= 22 || hour < 6) {
            if (brightness > 70) {
              brightness = 70;
              updateBrightness();
            }
          }
        }
        
        // Reload page when cycle completes (after showing all 3 ads)
        if (previousIndex === 2 && currentIndex === 0) {
          totalCycles++;
          addLog("Cycle complete - reloading page");
          setTimeout(() => location.reload(), 500);
        }
        
        previousIndex = currentIndex;
      }
    }

    // Admin panel functions
    function nextSlide() {
      currentIndex = (currentIndex + 1) % images.length;
      slideElement.src = images[currentIndex];
      addLog("Manual slide change: " + (currentIndex + 1));
    }

    function prevSlide() {
      currentIndex = (currentIndex - 1 + images.length) % images.length;
      slideElement.src = images[currentIndex];
      addLog("Manual slide change: " + (currentIndex + 1));
    }

    function updateDuration() {
      const input = document.getElementById("durationInput");
      const newDuration = parseInt(input.value) * 1000;
      if (newDuration >= 1000 && newDuration <= 60000) {
        slideDuration = newDuration;
        addLog("Slide duration changed to " + input.value + "s");
      }
    }

    function manualSync() {
      addLog("Manual sync requested...");
      syncServerTime();
    }

    async function checkLatency() {
      try {
        const t0 = performance.now();
        const response = await fetch(window.location.href, { method: "HEAD", cache: "no-store" });
        const t1 = performance.now();
        const latency = Math.round(t1 - t0);
        lastSyncLatency = latency;
        addLog("Latency check: " + latency + "ms");
      } catch (err) {
        addLog("Latency check failed: " + err.message);
      }
    }

    function reloadPage() {
      if (confirm("Reload page? This will restart the slideshow.")) {
        addLog("Reloading page...");
        setTimeout(() => location.reload(), 500);
      }
    }

    function clearLogs() {
      systemLog = [];
      updateLogView();
      addLog("Logs cleared");
    }

    function togglePause() {
      isPaused = !isPaused;
      const btn = document.getElementById("pauseBtn");
      const slideshow = document.getElementById("slideshow");
      if (isPaused) {
        btn.textContent = "‚ñ∂Ô∏è Resume";
        slideshow.classList.add("paused");
        addLog("Slideshow paused");
      } else {
        btn.textContent = "‚è∏Ô∏è Pause";
        slideshow.classList.remove("paused");
        addLog("Slideshow resumed");
      }
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
        addLog("Entered fullscreen");
      } else {
        document.exitFullscreen();
        addLog("Exited fullscreen");
      }
    }

    function updateBrightness() {
      brightness = document.getElementById("brightnessSlider").value;
      document.getElementById("brightnessValue").textContent = brightness + "%";
      applyFilters();
    }

    function updateContrast() {
      contrast = document.getElementById("contrastSlider").value;
      document.getElementById("contrastValue").textContent = contrast + "%";
      applyFilters();
    }

    function applyFilters() {
      slideElement.style.filter = "brightness(" + brightness + "%) contrast(" + contrast + "%)";
    }

    function toggleTransitions() {
      fadeEnabled = !fadeEnabled;
      const slideshow = document.getElementById("slideshow");
      if (fadeEnabled) {
        slideshow.classList.add("fade");
        addLog("Fade transitions enabled");
      } else {
        slideshow.classList.remove("fade");
        slideElement.style.opacity = "1";
        addLog("Fade transitions disabled");
      }
    }

    function toggleAutoDim() {
      autoDimEnabled = !autoDimEnabled;
      addLog("Auto-dim " + (autoDimEnabled ? "enabled" : "disabled"));
    }

    function toggleEmergency() {
      const overlay = document.getElementById("emergencyOverlay");
      const text = document.getElementById("emergencyText").value;
      
      if (!emergencyMode && text.trim()) {
        // Send emergency broadcast to server (broadcast to all devices)
        fetch(serverURL + "/api/emergency", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text, active: true })
        }).then(r => r.json()).then(data => {
          if (data.success) {
            emergencyMode = true;
            overlay.textContent = text;
            overlay.style.display = "flex";
            addLog("üö® EMERGENCY BROADCAST SENT TO ALL DEVICES: " + text);
          }
        }).catch(err => {
          addLog("‚ùå Failed to send broadcast: " + err.message);
        });
      } else {
        // Clear emergency broadcast from server
        fetch(serverURL + "/api/emergency", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: null, active: false })
        }).then(r => r.json()).then(data => {
          emergencyMode = false;
          overlay.style.display = "none";
          addLog("‚úì Emergency broadcast cleared from all devices");
        }).catch(err => {
          addLog("‚ùå Failed to clear broadcast: " + err.message);
        });
      }
    }

    // Check for emergency broadcasts from server (all devices poll for updates)
    async function checkEmergencyBroadcast() {
      if (isCheckingEmergency) return; // Prevent overlapping requests
      isCheckingEmergency = true;
      
      try {
        const response = await fetch(serverURL + "/api/emergency", { cache: "no-store" });
        const data = await response.json();
        const overlay = document.getElementById("emergencyOverlay");
        
        if (data.active && data.message && !emergencyMode) {
          // Emergency broadcast from another device
          emergencyMode = true;
          overlay.textContent = data.message;
          overlay.style.display = "flex";
          addLog("üö® EMERGENCY BROADCAST RECEIVED: " + data.message);
        } else if (!data.active && emergencyMode) {
          // Emergency broadcast was cleared
          emergencyMode = false;
          overlay.style.display = "none";
          addLog("‚úì Emergency broadcast cleared");
        }
      } catch (err) {
        // Server not available - continue running locally
        console.log("Emergency server unavailable: " + err.message);
      }
      
      isCheckingEmergency = false;
    }

    function exportLogs() {
      const logText = systemLog.join("\n");
      const blob = new Blob([logText], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "slideshow-logs-" + new Date().toISOString().slice(0, 19).replace(/:/g, "-") + ".txt";
      a.click();
      URL.revokeObjectURL(url);
      addLog("Logs exported");
    }

    function resetStats() {
      if (confirm("Reset all statistics?")) {
        startTime = Date.now();
        totalErrors = 0;
        totalImpressions = 0;
        totalCycles = 0;
        addLog("Statistics reset");
        updateStatusDisplay();
      }
    }

    // Keyboard handler
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        adminPanel.classList.remove("open");
        keySequence = "";
        return;
      }

      // Press 0 to force reload and resync
      if (e.key === "0") {
        addLog("Force reload triggered (key 0)");
        location.reload();
        return;
      }

      // Press F for fullscreen
      if (e.key === "f" || e.key === "F") {
        toggleFullscreen();
        return;
      }

      keySequence += e.key;
      if (keySequence.indexOf("123") !== -1) {
        adminPanel.classList.add("open");
        updateStatusDisplay();
        keySequence = "";
      }

      if (keySequence.length > 10) {
        keySequence = keySequence.slice(-10);
      }
    });

    // Initialize and start
    function start() {
      console.log("Initializing slideshow with", images.length, "images");
      console.log("Slide duration:", slideDuration / 1000, "seconds");
      
      addLog("Slideshow started - attempting sync in background");
      
      // Try to sync right away but don't block
      syncServerTime();
      
      // Show initial slide immediately
      updateSlide();
      addLog("Slideshow initialized - " + images.length + " images, " + (slideDuration/1000) + "s per slide");
      
      // Update status display every 100ms
      setInterval(() => {
        updateSlide();
        if (adminPanel.classList.contains("open")) {
          updateStatusDisplay();
        }
      }, 100);
      
      // Resync every 1 minute to stay accurate
      setInterval(syncServerTime, 60000);
      
      // Check for emergency broadcasts every 2 seconds (all devices poll)
      setInterval(checkEmergencyBroadcast, 2000);
      addLog("Emergency broadcast sync enabled - checking server every 2s");
    }

    start();
  </script>
</body>
</html>


